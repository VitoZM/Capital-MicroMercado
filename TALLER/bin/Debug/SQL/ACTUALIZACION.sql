CREATE TABLE CAJATARJETA(
IdCaja int identity primary key,
MontoTotal float,
MontoPrestado float,
MontoEfectivo float,
)

SELECT * FROM LISTARVENTAS V INNER JOIN LOTEVENTA LV ON V.IDVENTA=LV.IdVenta  WHERE LV.IDVENTA = 21
SELECT * FROM LOTEVENTA

DECLARE @IDPRO INT,@CAN INT,@EMP VARCHAR(10),@COR VARCHAR(10),@PRECO FLOAT,@PREVE FLOAT,@PRO VARCHAR(20)
SET @EMP = 'ENTEL'
SET @COR = '10 BS.'
SET @PRECO = 9.3
SET @PREVE = 10
SET @CAN = 13
SET @PRO = @EMP + ' ' + @COR
EXEC INSERTARPRODUCTO -1,'','TARJETA',@PRO,'1 UN.','TARJETAS',9.3,10,'','LADO ENTRADA'
SET @IDPRO = (SELECT MAX(IDPRODUCTO) FROM ALMACEN)
UPDATE ALMACEN SET CANTIDAD = @CAN WHERE IdProducto=@IDPRO

SELECT * FROM LISTARPRODUCTOS WHERE NOMBRE='TARJETA'

CREATE VIEW LISTARCLIENTESDEUDAS
AS
SELECT C.CICliente,C.Nombres,SUM(V.CostoTotal) AS DEUDA
FROM CLIENTE C INNER JOIN VENTA V ON C.IdCliente=V.IdCliente
WHERE V.PAGO='CREDITO' AND CICliente <> '5676906' GROUP BY C.CICliente,C.Nombres

ALTER PROC LISTARDEUDASCLIENTE @CI VARCHAR(20)
AS
	SELECT V.IDVENTA,U.NOMBRES+' '+U.APELLIDOS AS VENDEDOR,C.Nombres AS CLIENTE,V.FECHA,V.CostoTotal,V.Pago,V.Efectivo,V.Cambio,V.Estado,c.CICliente,v.Descripcion
	FROM CLIENTE C INNER JOIN VENTA V ON C.IdCliente=V.IdCliente
					INNER JOIN USUARIO U ON U.IdUsuario=V.IdUsuario
	WHERE V.PAGO='CREDITO' AND CICliente =@CI


ALTER PROC PAGARCREDITO @ID INT
AS
	UPDATE VENTA SET PAGO='EFECTIVO',Fecha=GETDATE(),Descripcion='DEUDA PAGADA' WHERE IDVENTA=@ID

UPDATE VENTA SET Fecha='2020/04/01', PAGO='CREDITO'WHERE IdCLIENTE<>1

SELECT * FROM VENTA
SELECT * FROM LISTARCLIENTESDEUDAS
EXEC LISTARDEUDASCLIENTE 10331470
EXEC PAGARCREDITO 85
SELECT * FROM LISTARVENTASHOY

---------------TARJETAS
---EJECUTAR